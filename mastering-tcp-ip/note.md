# 第1章ネットワーク基礎知識
## TCP/IP階層モデル
OSIよりだいぶシンプル

OCIモデル: 通信プロトコルに必要な機能はなにか?
TCP／IPモデル: プロトコルをコンピューターに実装するにはどのようにプログラミングしたらよいか?

- アプリケーション層
  - DNS, URI, HTML, HTTP, TLS/SSL, SMTP, POP, IMAP, MIME, TELNET, SSH, FTP, SNMP, MIB, SIP,, RTP, LDAP
- トランスポート層
  - TCP, UDP, UDP-Lite, SCTP, DCCP
- インターネット層
  - ARP, IP, ICMP
- データリンク層
- ハードウェア層


### ハードウェア層
イーサネットや電話回線など。とくに指定はない

### ネットワークインタフェース層
デバイスドライバ = OSとハードウェアの橋渡しをするソフトウェア

### インターネット層
IPプロトコル

インターネット層によってネットワークの細かい構造が抽象化されている。
途中の経路として通るイーサネットや専用回線などを意識しなくてよいように動く。
たとえばルーターはインターネット層を利用してパケットを転送する機能の実装が求められる。

TCP/IPモデルでは、インターネット層とトランスポート層がOSに組み込まれることを期待している。
インターネットに接続されるホストやルーターは必ずIPの機能を実装しなければならない。

ブリッジやリピーター、ハブについては必ずしもIP/TCPを実装する必要はない。

#### IP (Internet Protocol)
ネットワークをまたいでパケットを配送し、インターネット全体にパケットを送り届けるためのプロトコル。
それぞれのホストを識別するためにIPアドレスと呼ばれる識別子を使う。
到達保証はなく、再送などはしない。信頼性のないパケット交換プロトコルといえる。

データリンクの特性を隠蔽する役割もある。
IPのおかげで通信したい相手がどのようなデータリンクになっていても通信が可能になる。

#### ICMP (Internet Control Message Protocol)
IPパケットの配送中に何らかの以上が発生してパケットを転送できなくなった場合に、
パケットの送信元に委譲を知らせるために使われるプロトコル


#### ARP(Address Resolution Protocol)
パケットの送り先の物理的なアドレス(MACアドレスをIPアドレスから取得するプロトコル)


### トランスポート層
役割: アプリケーションプログラム間の通信を実現すること。

#### TCP (Transmission Control Protocol)
- コネクション型
- 信頼性のあるプロトコル

両端のホスト間でデータの到達性を保証する。
もし経路の途中でデータを運んでいるパケットがなくなったり、順番が入れ替わったりしてもTCPが解決する。
またそれ以外にも、ネットワークの帯域幅を有効に利用する仕組みやネットワークの混雑を和らげる仕組みなどがTCP上には組み込まれており
信頼性の向上が図られている。

ただしコネクションの確率・切断をするだけで制御のためのパケットのやりとりを約7回行なうため転送するデータの総量が少ない場合には無駄が多くなる。
またネットワークの利用効率を向上させるための複雑な仕組みが組み込まれているため、ビデオ会議の音声・映像データなどのように一定間隔で決められた量のデータを転送するのには向かない。

#### UDP (User Datagram Protocol)
UDPはTCPとは異なり
- コネクションレス
- 信頼性のないプロトコル

UDPは到達保証をしない。
パケットが相手に届いたかどうか、相手のコンピューターがちゃんとネットワークに接続したかどうかのチェックをシたい場合はアプリケーションのプログラムで行なう必要がある。

パケット数が少ない通信や、ブロードキャスト・マルチキャスト通信、ビデオや音声などのマルチメディア通信に向いている。



### アプリケーション層
- WWW
  - HTTP = アプリケーション層プロトコル(OSIでいうところの)
  - HTML = プレゼンテーション層プロトコル(OSIでいうところの)
- 電子メール
  - SMTP(通信プロトコル)
  - MIME(テキスト以外のデータを扱えるように拡張したもの、プレゼンテーション層)
- ファイル転送
  - FTP
    - ２つのコネクションをもつ
      - ファイル転送の指示をするための制御コネクション
      - 実際にデータを転送するためのデータコネクション
- 遠隔ログイン
  - TELNET (TELetypewriter)
  - SSH (Secure Shell)
- ネットワーク管理
  - SNMP (Simple Network Management Protocol)




## 通信例
### ヘッダの話
省略

### パケットの送信処理
- アプリケーション処理
- TCPモジュールの処理
  - コネクション確立、データ送信、コネクション切断
  - TCPヘッダ
    - 送信ホストと受信ホストのアプリケーションを識別するためのポート番号
    - そのパケットが何倍と目のデータなのかを示すシーケンス番号
  - それをIPにわたす
- IPモジュール
  - IPヘッダ
    - 宛先のIPアドレス、送信元のIPアドレス
    - 経路制御表(Routing Table)を参照して、IPパケットを次に受け渡すルーターやホストを決定する。
    - そしてその機器が接続しているネットワークインターフェイスのドライバにIPパケットを渡して、実際の送信処理をしてもらう
- ネットワークインタフェースの処理(イーサネットドライバ)
  - IPから渡されたIPパケットやイーサネットドライバから見ると単なるデータにすぎない。
  - イーサネットヘッダ
    - 宛先のMACアドレス、送信元のMACアドレス、イーサネットタイプ(イーサネットに続くデータのプロトコル)
  - ここでつくられたイーサネットパケットが物理層により相手に運ばれる。
  - 送信処理中にFCS(Frame Check Sequence)がハードウェアで計算され、パケットの最後につけられる。これはノイズなどによりパケットが破壊されたことを検出するためのもの。


  
### パケットの概観
|   　　データリンク層  　　　 | 　　　ネットワーク層　　　   | トランスポート層 | アプリケーション層 | データリンク層 |
========================================================================================================================
| 宛先     | 送信元　 | イーサ | 送信元　 | 宛先　　 | プロト | 送信元 | 送信先　| データ　　　　　　 | FCS            |　　
| Mac      | Mac      | ネット | IP       | IP       | コル   | ポート | ポート  |                    |                |
| アドレス | アドレス | タイプ | アドレス | アドレス | タイプ | 番号   | 番号    |                    |                |

### パケットの受信処理
TBA...


























